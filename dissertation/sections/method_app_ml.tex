%! TEX root = ../dissertation_gurecky.tex
\label{sec:ml_cfd}

For deployment as an in-line statistically based downscaling tool which sits between a subchannel code and a crud simulation code in a core simulator such as VERA the model is required to perform the hi2lo mapping for all pins in the core at any operating condition.  In other words, the model must be evaluable at any local core conditions typical of an operating PWR.  Since the training data set cannot contain all possible pin geometries, loading configurations and operating conditions due to computational expense, the model must make a prediction for the copula and marginal distribution parameters between known states.  This prediction is made by evaluating a trained gradient boosted regression tree in this case.

One might envision a table-lookup approach where high fidelity CFD flow field maps are pre-computed and stored for a wide array of flow and power conditions.  A nearest neighbor interpolation scheme could then be applied to extract the best-matching CFD map provided some local core state.  This however, is not tractable since the number of CFD computations to build the data base would be prohibitively large.  It is appealing to transform the problem of hi2lo construction from performing spatial flow map prediction into one of summary statistics prediction where much less information is required adequately fill out the operating envelope.  

In this chapter the hi2lo methodology introduced in this work is exercised against a small CFD data set derived from a 5x5 fuel assembly operating at realistic PWR conditions.


\section{Machine Learning Model Trained on CFD Data Source}

For the generation of high fidelity CFD data sets the Westinghouse 5x5 test stand shown in figures \ref{fig:5x5topdown} and \ref{fig:5x5side} was used to prepare the CAD geometry.  The CFD mesh consisted of approximately 25 million cells and 1e5 surface elements per pin.  A matching CTF input deck for the 5x5 assembly was also constructed with 100 axial zones.  The CTF and CFD codes were then executed for a variety of flow conditions and power levels.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\linewidth]{figs/5x5/5x5_top_down}
    \caption[Top down view of 5x5 pin Westinghouse facility.]{Top down view of 5x5 pin Westinghouse facility.  Assembly dimensions and pin powers redacted.}
    \label{fig:5x5topdown}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\linewidth]{figs/5x5/5x5_side}
    \caption[Side view of 5x5 pin Westinghouse facility.]{Side view of 5x5 pin Westinghouse facility.  Pin dimensions redacted.}
    \label{fig:5x5side}
\end{figure}


\subsection{Preprocessing}

TODO: Harvesting CFD data for training. Explain the pre-processing pipeline.

\begin{figure}[H]%
    \centering
    \subfloat[Pin 1]{{\includegraphics[width=0.45\linewidth]{figs/preproc/copula_params_pin_1} }}%
    \qquad
    \subfloat[Pin 2]{{\includegraphics[width=0.45\linewidth]{figs/preproc/copula_params_pin_2} }}%
    \qquad
        \subfloat[Pin 3]{{\includegraphics[width=0.45\linewidth]{figs/preproc/copula_params_pin_3} }}%
    \qquad
        \subfloat[Pin 4]{{\includegraphics[width=0.45\linewidth]{figs/preproc/copula_params_pin_4} }}%
    \qquad
    \caption[Best fitting copula to CFD data.]{Best fitting copula class as determined by the AIC as a function of axial rod position.}%
    \label{fig:copula_predicted}%
\end{figure}


\subsection{Feature Engineering}

The objective of feature engineering is to select a predictive variable set that can describe the behavior of the conditional quantiles and copula everywhere in the assembly.   
   
\begin{table}[h]
    \begin{center}
    \caption[Included exogenous training features.]{Features included in the gradient boosted models as exogenous variables.}
\begin{tabular}[h]{|l | l | l | l |}
    \hline
    Sym & Label & Feature & Unit \\
    \hline
    \hline
    $T$ & ctf\_twall\_avg & CTF Face surface temperature & $[K]$ \\
    $R_T$ & ctf\_twall\_range & Surface temperature range in 4 adjacent faces & $[K]$ \\ 
    $q''$ & ctf\_bhf\_avg & Local CTF face heat flux & $[W/m^2]$ \\
    $R_{q''}$ & ctf\_bhf\_range & Heat flux range in 4 adjacent faces & $[W/m^2]$ \\ 
    $u_z$ & w\_bulk & CTF subchannel bulk Z Velocity &  $[m/s]$ \\
    $k$ & ctf\_tke\_avg & Local CTF face near wall TKE &  $[J/kg]$ \\
    $R_k$ & ctf\_tke\_range & CTF TKE range in 4 adjacent faces & $[J/kg]$ \\ 
    $z$ & z & Global axial position & $[m]$ \\
    $\delta z_g$ & dz\_grid & Position relative to nearest spacer grid & $[m]$ \\
    $N_g$ & n\_upsteam\_grid  & Nearest upstream spacer grid ID & $[]$ \\
    $T_\infty$ & t\_bulk & Subchannel bulk temperature  &  $[K]$ \\
    \hline
\end{tabular}
\label{tab:features}
\end{center}
\end{table}

The predictive variables given in table \ref{tab:features} were selected based on two criteria:  availability and orthogonality.  A predictive variable must be made available by VERA or must be computable from CTF results alone.  This must be true since when evaluating the hi2lo model, the inputs to the hi2lo model must come from either previously stored information or information made available by CTF at runtime.  At this juncture, this criteria precludes using information such as geometric orientation of a given spacer grid since it is not possible to extract or infer this information from the CTF output.

It is not useful to include multiple variables which are co-linear. The bulk fluid density was not included in the predictive variable set as it strongly depends on the local temperature. Likewise the local static pressure was not used as a predictive variable since this would be one-to-one with the axial position.  The exclusion of this TH information is primarily done for computational saving when training the boosted models since, as opposed to other machine learning algorithms and statistical inference techniques, gradient boosting is robust to collinearity of features in the input space. 

In this case the inclusion of nuisance or collinear exogenous variables in the model will not necessarily reduce the model's ability to generalize to unseen data, only hamper computational efficiency.  The resulting feature importance plot shown in figure \ref{fig:ktauregfeatureimp} suggests that the relative axial position within a span does not provide predictive power since this information is redundant provided the absolute axial position and the nearest upstream spacer grid.  

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{figs/ktau_reg_feature_imp}
    \caption[Relative feature importance.]{Relative feature importances on kendall's $\tau$.}
    \label{fig:ktauregfeatureimp}
\end{figure}

TODO: Include example training table.  With predictive features and endogenous variable columns.



\subsection{Cross Validation}

An estimate of the interpolation error incurred when evaluating the trained models at unknown CFD states can be made by performing a leave one out (LOO) cross validation study.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.3\linewidth]{figs/drawings/5x5_loo}
    \caption[Example pin layout for leave-one-out cross validation procedure.]{Example pin layout for leave-one-out cross validation procedure.  The gradient boosted models are trained on CFD and CTF data extracted from the blue pins.  Crud predictions are made on the missing pin.}
    \label{fig:5x5loo}
\end{figure}


As depicted in figure \ref{fig:5x5loo}, in this procedure a single CFD/CTF pin pair is removed from the database and then the model is retrained on remaining data.  Following this retraining, a crud prediction is made 
at the missing pin's TH conditions.  The crud results are compared against crud results generated using the full training data set.  This process is repeated by sequentially for each pin in the 5x5 set.  The differences are summarized and averaged to obtain a measure of model's predictive performance when applied to TH conditions that reside in the TH training envelope.

This cross validation technique only ascertains interpolation errors within the TH envelope enclosed by the original full training set.  The resulting interpolation error estimates cannot be extrapolated to core conditions that lay outside of the training set.  For a robust interpolation error analysis, a much larger training data set is required
that spans essentially all possible TH conditions encountered in an operational PWR.  This will require large scale CFD runs and is left as a avenue for future uncertainty quantification work.

\subsection{Quantile Regressors}

\begin{itemize}   
    \item (\xmark) \sout{Compute quantile uncertainty estimates associated with predicted quantiles provided by the trained ML model} (Unsure if feasible.  Look at BART ensemble of trees method. Future work)
    \item (\xmark) \sout{Propagate ML model-induced quantile uncertainties} (Future work)
\end{itemize}


Q-Q plots of the  temperature and TKE residual distributions are used to elucidate bias introduced by the machine learning model in the conditional quantiles at a variety of axial positions and local core conditions.  Estimated quantiles are obtained for the left-out pin by evaluating the trained reduced LOO model and are compared to the expected CFD result.
A subset of the TKE residual quantile regression results are given in figure \ref{fig:tkepin1} to \ref{fig:tkepin3}.  The Q-Q plots summarize the biases in the conditional quantile distributions when compared to the target golden standard CFD data.  The maximum and average Kolmogorovâ€“Smirnov (KS) statistic is provided in the Q-Q figures for each pin.  This statistic was computed at each axial level on the CTF grid.

\begin{figure}[H]%
    \centering
    \subfloat[TKE quantile regression results. CFD in solid line.  Predicted values as dashed.]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/q_tke_regression_1} }}%
    \qquad
    \subfloat[Q-Q plot of TKE quantile regression predictions from LOO cross validation study]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/qq_tke_pin_1} }}%
    \caption[Q-Q LOO TKE pin 1 results.]{Pin 1 TKE quantile regression predictions from LOO cross validation study.}%
    \label{fig:tkepin1}%
\end{figure}

\begin{figure}[H]%
    \centering
    \subfloat[TKE quantile regression results. CFD in solid line.  Predicted values as dashed.]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/q_tke_regression_2} }}%
    \qquad
    \subfloat[Q-Q plot of TKE quantile regression predictions from LOO cross validation study]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/qq_tke_pin_2} }}%
    \caption[Q-Q LOO TKE pin 2 results.]{Pin 1 TKE quantile regression predictions from LOO cross validation study.}%
    \label{fig:tkepin2}%
\end{figure}

\begin{figure}[H]%
    \centering
    \subfloat[TKE quantile regression results. CFD in solid line.  Predicted values as dashed.]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/q_tke_regression_3} }}%
    \qquad
    \subfloat[Q-Q plot of TKE quantile regression predictions from LOO cross validation study]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/qq_tke_pin_3} }}%
    \caption[Q-Q LOO TKE pin 3 results.]{Pin 1 TKE quantile regression predictions from LOO cross validation study.}%
    \label{fig:tkepin3}%
\end{figure}


A subset of the Temperature residual quantile regression results are given in figure \ref{fig:temppin1} to \ref{fig:temppin3}.  Similar to the TKE conditional quantiles, the conditional temperature distribution exhibits sharp changes in behavior across the spacer grids.  These discontinuities enforced the choice of a machine learning algorithm, such as gradient boosted regression trees, which are resilient to extremely sharp gradients in the response surface.  Section () investigates this characteristic of gradient boosted regression tree models.

\begin{figure}[H]%
    \centering
    \subfloat[Temperature quantile regression results. CFD in solid line.  Predicted values as dashed.]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/q_twall_regression_1} }}%
    \qquad
    \subfloat[Q-Q plot of Temperature quantile regression predictions from LOO cross validation study]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/qq_twall_pin_1} }}%
    \caption[Q-Q LOO Temperature pin 1 results.]{Pin 1 Temperature quantile regression predictions from LOO cross validation study.}%
    \label{fig:temppin1}%
\end{figure}

\begin{figure}[H]%
    \centering
    \subfloat[Temperature quantile regression results. CFD in solid line.  Predicted values as dashed.]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/q_twall_regression_2} }}%
    \qquad
    \subfloat[Q-Q plot of Temperature quantile regression predictions from LOO cross validation study]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/qq_twall_pin_2} }}%
    \caption[Q-Q LOO Temperature pin 2 results.]{Pin 2 Temperature quantile regression predictions from LOO cross validation study.}%
    \label{fig:temppin2}%
\end{figure}

\begin{figure}[H]%
    \centering
    \subfloat[Temperature quantile regression results. CFD in solid line.  Predicted values as dashed.]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/q_twall_regression_3} }}%
    \qquad
    \subfloat[Q-Q plot of Temperature quantile regression predictions from LOO cross validation study]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/qq_twall_pin_3} }}%
    \caption[Q-Q LOO Temperature pin 3 results.]{Pin 3 Temperature quantile regression predictions from LOO cross validation study.}%
    \label{fig:temppin3}%
\end{figure}

\subsection{Kendall's $\tau$ Regression}

A subset of the 5x5 assembly's Kendall's $\tau$ regression results are given in figure \ref{fig:ktauregression}.  There is a marked change in behavior of the rank correlation coefficient as a function of axial position in the core from pin to pin.  The influence of Kendall's $\tau$ on the CTF face-integrated crud results was discussed in section \ref{sec:crud_copula_sensi}, and it was shown to be an important parameter to accurately predict via the machine learning model.  Pins with large relative errors for Kendall's $\tau$ are expected to produce anomalously poor crud predictions.

\begin{figure}[H]%
    \centering
    \subfloat[Pin 1]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/ktau_regression_1} }}%
    \qquad
    \subfloat[Pin 2]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/ktau_regression_2} }}%
    \qquad
    \subfloat[Pin 3]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/ktau_regression_3} }}%
    \qquad
    \subfloat[Pin 4]{{\includegraphics[width=0.45\linewidth]{figs/ml_fit/ktau_regression_4} }}%
    \qquad
    \caption[Kendall's $\tau$ regression LOO results.]{Kendall's $\tau$ regression results from LOO cross validation study.}%
    \label{fig:ktauregression}%
\end{figure}
To combat poor performance of the Kendall's $\tau$ regressors, a larger training set should be investigated in future work.  For this limited 25 pin data set, it is hypothesized that each pin has a substantially unique flow field when compared to the other 24 pins.  Therefore, when expelling a pin from the training data set for cross validation the predictive performance of the model will suffer since the remaining pins in the training set do not provide the requisite information about the local core conditions vs. Kendall's $\tau$ relationship for the missing pin.

\subsection{Copula Classifier}

In addition to the rank correlation coefficient, Kendall's $\tau$, the copula family is also required to recover the copula density function on each CTF face.  To this end a gradient boosted classifier was trained on the available CFD data.  Copula information extracted from the raw CFD results is shown in figure \ref{fig:copula_predicted}.

Figure \ref{fig:confusionmatrixavg} summarizes the LOO cross validation results of the copula classifier as a confusion matrix.  The diagonal entries of the confusion matrix represent the correctly labeled copula predictions made by the reduced LOO trained classifier for each copula family average over the entire 5x5 assembly.  It is shown that on average the classifier predicts an incorrect result more often than not.  

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\linewidth]{figs/confusion_matrix_avg}
    \caption[Copula classifier confusion matrix.]{Copula classifier confusion matrix.}
    \label{fig:confusionmatrixavg}
\end{figure}


The copula classifiers performance averaged over all pins is shown in figure \ref{fig:confusionmatrixavg}. The copula classifier struggles to predict the correct copula class given the local TH state and axial core position.  As indicated in figure \ref{fig:copula_predicted}, the behavior of the copula as a function of axial rod position are erratic and inconsistent from pin to pin.  Introducing other TH exogenous variables in addition to the axial position did not increase the classification score significantly.  We can conclude that the copula are not well described by local core condition and axial position.  It remains as future work to investigate if including additional geometric pin and grid attributes could improve the classification results.  Additional software infrastructure would be required to both write geometric pin and grid features from CTF and to utilize the geometric features in the current model.

Additional future work could include performing a non-linear transformation of the input space so that the copula labels are approximately linearly separable in the transformed space.  Potential candidate methods for building this transformation are the UMAP [ref] and tSNE [ref] manifold learning algorithms.  Classification performed in the transformed space could result in better performance but this is yet to be demonstrated for this copula vs local core condition dataset.

\section{Single Pin Comparisons}

\begin{itemize}
    \item (\checkmark-) Show Kendall's tau vs Axial position for a single pin.  The rank correlation coefficient shows
    the influence of spacer grids on the joint distribution of temperature and turbulent kinetic energy.
    \item ($\cdot$) Show predicted Copula as a function of axial position.  Is there a clear trend here (i.e. is a guassian copula
    a good fit far away from spacer grids and the clayton copula a better fit near spacer grids?  (TODO: create this plot functionality - capability to compute best-fit copula already exists)
    \item (\checkmark-) Compare Gaussian vs best-fit copula crud results.
    \item (\checkmark-) Show axial crud comparisons for a single hi2lo, CFD and CTF pin.
    \item (\checkmark-) Show integrated crud comparisons for a single hi2lo, CFD and CTF pin.
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/1_5_axial_bmass}
    \caption{Pin 1 CTF vs CFD vs Hi2lo axial crud boron mass distribution.}
    \label{fig:15axialbmass}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/1_5_axial_cmass}
    \caption{Pin 1 CTF vs CFD vs Hi2lo axial crud mass distribution.}
    \label{fig:15axialcmass}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/1_5_pin_bmass_time}
    \caption{Pin 1 CTF vs CFD vs Hi2lo integrated crud boron mass distribution as a function of time.}
    \label{fig:15pinbmasstime}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/1_5_pin_cmass_time}
    \caption{Pin 1 CTF vs CFD vs Hi2lo integrated crud mass distribution as a function of time.}
    \label{fig:15pincmasstime}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tstep_5/pin_1/hi2lo_imp_pin_bmass}
    \caption{}
    \label{fig:hi2loimppinbmass}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tstep_5/pin_1/hi2lo_imp_pin_cmass}
    \caption{}
    \label{fig:hi2loimppincmass}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tstep_5/pin_1/hi2lo_imp_pin_z_bmass}
    \caption{}
    \label{fig:hi2loimppinzbmass}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tstep_5/pin_1/hi2lo_imp_pin_z_cthick}
    \caption{}
    \label{fig:hi2loimppinzcthick}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tstep_5/pin_1/hi2lo_imp_pin_z_tke}
    \caption{}
    \label{fig:hi2loimppinztke}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tstep_5/pin_1/hi2lo_imp_pin_z_twall}
    \caption{}
    \label{fig:hi2loimppinztwall}
\end{figure}

\section{Multi Pin Comparisons}

\begin{itemize}
    \item (\checkmark-) Exercise hi2lo method with 5x5 CFD data set.
    \item (\checkmark-) Show pin-by-pin statistics to show if a geometric bias is present.  Are we always over predicting crud
    in pins near the edge of the assembly?
    \item (\checkmark-) Show axial CFD vs CTF vs hi2lo results for each pin.
    \item (\checkmark-) Compare total integrated assembly crud mass and boron bass for CFD vs CTF vs hi2lo.
\end{itemize}

% Hi2lo Bmass results
\begin{table}[h]
    \begin{center}
    \caption[Hi2lo crud boron mass results]{Crud boron mass hi2lo LOO result summary.}
    \begin{tabular}[h]{|c|c|c|c|} 
        \hline
Pin & CTF Bmass Tot & CFD Bmass Tot & Hi2lo Bmass Tot  \\ 
\hline
1  & 1.2940e-07 & 7.5489e-08 & 6.3163e-08 \\ 
2  & 1.1458e-07 & 5.1953e-08 & 3.1487e-08 \\ 
3  & 1.0265e-07 & 3.2678e-08 & 3.4192e-08 \\ 
4  & 1.0111e-07 & 5.6847e-08 & 2.9848e-08 \\ 
5  & 9.5319e-08 & 1.8974e-08 & 2.2723e-08 \\ 
6  & 4.0505e-08 & 9.1686e-09 & 1.0065e-08 \\ 
7  & 8.0907e-09 & 4.0210e-09 & 3.7515e-09 \\ 
8  & 6.5705e-09 & 2.9861e-09 & 3.3475e-09 \\ 
9  & 6.7204e-09 & 3.3324e-09 & 3.3063e-09 \\ 
10  & 6.6850e-09 & 3.5892e-09 & 2.8171e-09 \\ 
11  & 8.7449e-09 & 4.0316e-09 & 3.7932e-09 \\ 
12  & 4.6693e-08 & 1.1722e-08 & 8.2669e-09 \\ 
13  & 1.0616e-07 & 2.2909e-08 & 2.6878e-08 \\ 
14  & 1.0617e-07 & 2.7471e-08 & 3.9548e-08 \\ 
15  & 1.0366e-07 & 4.5067e-08 & 3.3163e-08 \\ 
16  & 1.1594e-07 & 2.9707e-08 & 4.3385e-08 \\ 
17  & 9.1090e-08 & 2.6739e-08 & 2.6569e-08 \\ 
18  & 7.1616e-08 & 2.3468e-08 & 2.0092e-08 \\ 
19  & 6.1329e-08 & 1.1289e-08 & 1.4341e-08 \\ 
20  & 1.6370e-08 & 7.2277e-09 & 4.8991e-09 \\ 
21  & 1.2524e-08 & 4.5454e-09 & 4.4092e-09 \\ 
22  & 1.7007e-08 & 4.4576e-09 & 6.1729e-09 \\ 
23  & 6.2594e-08 & 1.5092e-08 & 1.1521e-08 \\ 
24  & 7.1144e-08 & 1.8479e-08 & 2.1561e-08 \\ 
25  & 4.1668e-08 & 1.3290e-08 & 8.6106e-09 \\ 
\hline
\end{tabular}
\label{tab:loo_crud_bmass}
\end{center}
\end{table}


% hi2lo cmass results
\begin{table}[h]
    \begin{center}
        \caption[Hi2lo crud mass results]{Crud mass hi2lo LOO result summary.}
    \begin{tabular}[h]{|c|c|c|c|} 
        \hline
  Pin & CTF Cmass Tot & CFD Cmass Tot & Hi2lo Cmass Tot  \\ 
\hline
1  & 2.4316e-04 & 1.4232e-04 & 1.1899e-04 \\ 
2  & 2.1537e-04 & 9.8041e-05 & 5.9479e-05 \\ 
3  & 1.9302e-04 & 6.1962e-05 & 6.4702e-05 \\ 
4  & 1.9040e-04 & 1.0737e-04 & 5.6557e-05 \\ 
5  & 1.7982e-04 & 3.6318e-05 & 4.3346e-05 \\ 
6  & 7.6893e-05 & 1.7713e-05 & 1.9431e-05 \\ 
7  & 1.5980e-05 & 7.9597e-06 & 7.4350e-06 \\ 
8  & 1.3032e-05 & 5.9122e-06 & 6.6394e-06 \\ 
9  & 1.3329e-05 & 6.6094e-06 & 6.5574e-06 \\ 
10  & 1.3259e-05 & 7.1162e-06 & 5.5866e-06 \\ 
11  & 1.7213e-05 & 7.9487e-06 & 7.5059e-06 \\ 
12  & 8.8404e-05 & 2.2533e-05 & 1.5989e-05 \\ 
13  & 2.0002e-04 & 4.3636e-05 & 5.1048e-05 \\ 
14  & 1.9970e-04 & 5.2130e-05 & 7.4719e-05 \\ 
15  & 1.9474e-04 & 8.4999e-05 & 6.2756e-05 \\ 
16  & 2.1787e-04 & 5.6215e-05 & 8.1922e-05 \\ 
17  & 1.7124e-04 & 5.0727e-05 & 5.0361e-05 \\ 
18  & 1.3477e-04 & 4.4664e-05 & 3.8244e-05 \\ 
19  & 1.1573e-04 & 2.1674e-05 & 2.7412e-05 \\ 
20  & 3.1488e-05 & 1.4063e-05 & 9.6251e-06 \\ 
21  & 2.4285e-05 & 8.9271e-06 & 8.6669e-06 \\ 
22  & 3.2634e-05 & 8.7701e-06 & 1.2055e-05 \\ 
23  & 1.1797e-04 & 2.8810e-05 & 2.2075e-05 \\ 
24  & 1.3379e-04 & 3.5204e-05 & 4.0989e-05 \\ 
25  & 7.8681e-05 & 2.5506e-05 & 1.6677e-05 \\ 
\hline
\end{tabular}
\label{tab:loo_crud_cmass}
\end{center}
\end{table}

% RMS error table
\begin{table}[h]
    \begin{center}
        \caption[Hi2lo crud RMS summary.]{Hi2lo crud RMS summary.}
    \begin{tabular}[h]{|c|c|c|c|c|c|c|c|} 
        \hline
Pin  & RMS & RMS & RMS & RMS & RMS & RMS & RMS \\
\hline
1  & 6.2482e-04 & -2.3332e-05 & 3.3009e-07 & -1.2326e-08 & 7.5489e-08 & 1.4232e-04 & 0.0000e+00 \\ 
2  & 8.1392e-04 & -3.8562e-05 & 4.3183e-07 & -2.0466e-08 & 5.1953e-08 & 9.8041e-05 & 0.0000e+00 \\ 
3  & 2.0189e-04 & 2.7399e-06 & 1.0731e-07 & 1.5140e-09 & 3.2678e-08 & 6.1962e-05 & 0.0000e+00 \\ 
4  & 1.0737e-03 & -5.0812e-05 & 5.7008e-07 & -2.6998e-08 & 5.6847e-08 & 1.0737e-04 & 0.0000e+00 \\ 
5  & 2.2335e-04 & 7.0283e-06 & 1.1847e-07 & 3.7498e-09 & 1.8974e-08 & 3.6318e-05 & 0.0000e+00 \\ 
6  & 6.5623e-05 & 1.7178e-06 & 3.4608e-08 & 8.9595e-10 & 9.1686e-09 & 1.7713e-05 & 0.0000e+00 \\ 
7  & 2.1295e-05 & -5.2469e-07 & 1.0898e-08 & -2.6945e-10 & 4.0210e-09 & 7.9597e-06 & 0.0000e+00 \\ 
8  & 1.8572e-05 & 7.2717e-07 & 9.4019e-09 & 3.6144e-10 & 2.9861e-09 & 5.9122e-06 & 0.0000e+00 \\ 
9  & 1.0839e-05 & -5.1974e-08 & 5.4659e-09 & -2.6075e-11 & 3.3324e-09 & 6.6094e-06 & 0.0000e+00 \\ 
10  & 2.4348e-05 & -1.5296e-06 & 1.2298e-08 & -7.7213e-10 & 3.5892e-09 & 7.1162e-06 & 0.0000e+00 \\ 
11  & 2.9659e-05 & -4.4282e-07 & 1.5478e-08 & -2.3832e-10 & 4.0316e-09 & 7.9487e-06 & 0.0000e+00 \\ 
12  & 1.9073e-04 & -6.5447e-06 & 1.0111e-07 & -3.4547e-09 & 1.1722e-08 & 2.2533e-05 & 0.0000e+00 \\ 
13  & 3.9831e-04 & 7.4119e-06 & 2.1135e-07 & 3.9690e-09 & 2.2909e-08 & 4.3636e-05 & 0.0000e+00 \\ 
14  & 5.0327e-04 & 2.2589e-05 & 2.6950e-07 & 1.2076e-08 & 2.7471e-08 & 5.2130e-05 & 0.0000e+00 \\ 
15  & 5.5978e-04 & -2.2242e-05 & 2.9813e-07 & -1.1904e-08 & 4.5067e-08 & 8.4999e-05 & 0.0000e+00 \\ 
16  & 5.6026e-04 & 2.5707e-05 & 2.9830e-07 & 1.3678e-08 & 2.9707e-08 & 5.6215e-05 & 0.0000e+00 \\ 
17  & 1.2664e-04 & -3.6509e-07 & 6.6854e-08 & -1.7016e-10 & 2.6739e-08 & 5.0727e-05 & 0.0000e+00 \\ 
18  & 1.8205e-04 & -6.4199e-06 & 9.5976e-08 & -3.3756e-09 & 2.3468e-08 & 4.4664e-05 & 0.0000e+00 \\ 
19  & 1.2838e-04 & 5.7381e-06 & 6.8271e-08 & 3.0523e-09 & 1.1289e-08 & 2.1674e-05 & 0.0000e+00 \\ 
20  & 9.7915e-05 & -4.4377e-06 & 5.1674e-08 & -2.3286e-09 & 7.2277e-09 & 1.4063e-05 & 0.0000e+00 \\ 
21  & 1.7636e-05 & -2.6016e-07 & 9.2180e-09 & -1.3620e-10 & 4.5454e-09 & 8.9271e-06 & 0.0000e+00 \\ 
22  & 6.7042e-05 & 3.2845e-06 & 3.5199e-08 & 1.7153e-09 & 4.4576e-09 & 8.7701e-06 & 0.0000e+00 \\ 
23  & 1.7096e-04 & -6.7350e-06 & 9.0595e-08 & -3.5703e-09 & 1.5092e-08 & 2.8810e-05 & 0.0000e+00 \\ 
24  & 1.5885e-04 & 5.7841e-06 & 8.4133e-08 & 3.0827e-09 & 1.8479e-08 & 3.5204e-05 & 0.0000e+00 \\ 
25  & 1.9995e-04 & -8.8282e-06 & 1.0617e-07 & -4.6799e-09 & 1.3290e-08 & 2.5506e-05 & 0.0000e+00 \\ 
\hline
\end{tabular}
\label{tab:loo_rms}
\end{center}
\end{table}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/asm_cmass_time}
    \caption{Assembly integrated CTF vs CFD vs Hi2lo crud mass as a function of time.}
    \label{fig:asmcmasstime}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/l2_boron_asm_errors_hmap}
    \caption{5x5 Axial RMS crud boron mass relative error distribution.}
    \label{fig:l2boronasmerrorshmap}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/l2_cmass_asm_errors_hmap}
    \caption{5x5 Axial RMS crud mass relative error distribution.}
    \label{fig:l2cmassasmerrorshmap}
\end{figure}


\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tot_bmass_rel_asm_errors_hmap}
    \caption{5x5 Integrated crud boron mass relative error distribution.}
    \label{fig:totbmassrelasmerrorshmap}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tot_boron_asm_errors_hmap}
    \caption{5x5 Integrated crud boron mass absolute error distribution.}
    \label{fig:totboronasmerrorshmap}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tot_cmass_asm_errors_hmap}
    \caption{5x5 Integrated crud mass absolute error distribution.}
    \label{fig:totcmassasmerrorshmap}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/5x5/imp/tot_cmass_rel_asm_errors_hmap}
    \caption{5x5 Integrated crud mass relative error distribution.}
    \label{fig:totcmassrelasmerrorshmap}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.95\linewidth]{figs/5x5/imp/asm_error_corr}
    \caption{Correlation of ML errors with crud prediction errors.}
    \label{fig:asmerrorcorr}
\end{figure}

\subsection{Section Takeaways}


\begin{itemize}
    \item A leave one out cross validation strategy was utilized to quantify the predicted performance of the model.  For this cross validation strategy the model was trained on data provided by 24 pins.  Predictions were made for the left-out pin and compared against the expected results.  This process was repeated for all 25 pins in the assembly.

	\item The copula classifier performed poorly given the current set of considered explanatory variables.  Future work is required to identify additional predictors to include in the explanatory variable set.  However, figures () and () show that the selected copula model family (eg. Gumbel, Frank, Clayton or Gaussian) does not influence the integrated crud result on a patch or pin as strongly as the rank correlation coefficient, Kendall's tau.
\end{itemize}
