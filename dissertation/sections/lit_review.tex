%! TEX root = ../dissertation_gurecky.tex

The problem of correcting thermal hydraulic predictions provided by a subchannel code using higher fidelity CFD results can be viewed from the perspective of statistical downscaling.  There are abundant examples of statistical downscaling techniques in the weather forecasting and geological literature.  One commonality across all studied procedures is the presence of a high and low fidelity data source and a goal to make credible predictions of the target field between known coarsely resolved sample locations.  The problem is one of data amalgamation, where the resultant downscaling model preserves some average aspects of the low fidelity model with the added benefits of uncertainty and spatial fidelity afforded by the finer scale data.

\section{Statistical Downscaling}

Statistical downscaling (SD) methods seek a statistical link between a low and high fidelity features.
In particular in the climate and weather data communities it is common to perform local bias-correction on coarsely resolved weather models provided local weather station measurements [ref]. A common situation which lends itself to SD methods is to have disparate resolution sample data; one set is typically provided by a coarsely resolved global circulation model (GCM) and a secondary set of finely resolved local rain and wind field measurements is provided by local weather stations, satellite or radar sources.  In addition to the longitude and latitude of these measurements, the fine scale data may also be asscosiated with auxiliary features at such as the terrain height.
\index{Statistical Downscaling}

Results from a SD model should be carefully interpreted since at fine scale resolutions point estimates for the fields represent a single realization of a random variable governed by a fitted underlaying distribution.  Depending on the models used to capture statistical variation in the spatial and temporal trends it is sometimes necessary to draw many samples from the SD model to estimate the mean and higher moments.  These mean and variance estimates can then be compared against a historical validation data set.

Precipitation estimates provided by statistically downscaled climate models are used as a boundary condition to local hydrology models for runoff \cite{wood2002}, flood, and aquifer replenishment studies.  One may draw a parallel with the current crud simulation work where bias-corrected subchannel TH results are passed to a corrosion chemistry or crud simulation package.

A particular class of SD methods known as bias-corrected spatial disaggregation (BCSD) rely on computing estimates of time-and-space aggregated rainfall percentiles given previous historical local station data \cite{wood2002}.  In this method, the spatially and temporally fine data is aggregated to the coarse scale GCM grid before percentiles are computed.  These models have been used to forecast the probability of extreme precipitation events in a given local region which is important for flood risk assessment studies [ref].  The problem is similar to highly threshold-sensitive crud problem since flood risk models require accurate frequency and magnitudes of extreme rainfall events which are difficult to quantify along with coarse scale GCMs alone.
\index{Statistical Downscaling!Bias Corrected}

Several factors prohibit the application of BSCD techniques directly to the hi2lo problem at hand.  The majority of BSCD literature does not consider the simultaneous prediction of multiple correlated random fields.  Additionally, the BSCD models do not typically consider a large number of exogenous covariates in their construction - only the spatial and temporal coordinates are used which constrains the statistical downscaling maps to be nontransferable to other geographic locations.  Finally, resolving fine spatial detail of the temperature and TKE fields in a given CTF face isn't necessary for accurate crud prediction when using a single dimensional crud simulation code since no azimuthal or axial variation in these surface fields are utilized in the crud package.  Therefore, the problem of finding the fractional area of a CTF face which exists above a threshold is preferable to spatial disaggregation techniques in the current hi2lo crud application.

It is also possible to nest a high fidelity simulation within a coarse fidelity weather simulation. Boundary conditions and constraints are supplied by the coarse fidelity model to the nested regional high resolution weather model.  The practice of coupling regional weather models with coarse scale global models is sometimes referred to as dynamical downscaling, though, this weather modeling strategy can also be viewed as a particular tightly coupled multi-scale model.  There are examples of such coupled simulation in reactor physics (see literature on coupled coarse RELAP and CFD models.  CFD is used where the flow is 'complicated' but RELAP handles the primary loop piping and heat exchanger)  The construction of dynamical downscaling models are not the focus of the current hi2lo work and will not be discussed further.

\section{Kriging}

Kriging or Gaussian process regression techniques are well suited when the errors can be assumed to be normally distributed about some mean prediction.  Simple kriging assumes that the mean of the underlaying field does not drift as a function location in the input space and therefore only requires the fitting of a co-variogram which describes the statistical spatial autocorrelation between the known data.  More advanced kriging strategies such as regression kriging (RK) forgo this simplification decomposing the interpolation problem into mean predicting and bias-correcting residual models.  In RK the spatial-autocorrelation in the residuals is modeled by a simple kriging model.  The mean response may be predicted by any regression strategy, with a common choice being an ordinary least squares model though works which investigate the use of random-forests or more advanced machine learning strategies in this role are pervasive [refs].

\index{Kriging}
\index{Kriging!Regression Kriging}

\section{Subchannel Hi2lo}

The utilization of CFD data to improve subchannel thermal hydraulic models does not necessarily take on a statistical downscaling characteristic.  Oftentimes the strategy by which one uses CFD data to improve a subchannel model can be developed using standard Bayesian inference techniques in which model parameters are inferred through comparing the low fidelity model to high fidelity experimental or CFD data.  This flavor of inverse problem oftentimes involves  model calibration, model selection and experimental design aspects.  A wide array of literature exists on each of these topics and will not be interrogated here.  Instead, a pointed literature review of the latest CFD-informed subchannel work is considered.

 M. Avramova developed CFD informed grid mixing models in CTF.  This work leveraged CFD results to improve the momentum balance and grid mixing models in CTF \cite{avramova2007}.  The lateral momentum equations implemented in CTF are provided in equation \ref{eq:ctf_lat_mom}.

    	\begin{align}
    	& \frac{\partial }{\partial t}(\alpha_l \rho_l \mathbf U_l)
    	+ \nabla \cdot (\alpha_l \rho_l \mathbf U_l \mathbf U_l) \nonumber \\
    	&= \alpha_l \rho_l \mathbf{g} - \alpha_l \nabla P + 
    	\nabla \cdot (\alpha_l \bm{\tau}_l) \nonumber \\
    	&+ M^L_l + M^d_l + M^T_l + M_l^{GDXF}
        \label{eq:ctf_lat_mom}
    	\end{align}
        
Where $l$ denotes the liquid phase and $\alpha$ is the volume fraction liquid.  The terms $M^L, M^d, M^T, M_l^{GDXF}$ account for droplet or bubble entrainment, phase interfacial drag, turbulent mixing and grid directed cross flow respectively.  Avramova devised a method to use CFD computations to obtain an accurate prediction of $M_l^{GDXF}$ for a variety of grid designs.
    	
The grid directed cross flow momentum source term used in Avramova's model is defined by equation \ref{eq:grid_en_xflow_coeff}.
    	\begin{equation}
    	M_l^{GDXF} = f^2_{sg}(z) u_l^2 \rho_l A_g S_g
        \label{eq:grid_en_xflow_coeff}
    	\end{equation}
    	Where $u_l$ is the axial liquid velocity. 
    	\begin{equation}
    	f_{sg}(z) = \frac{V^{CFD}_l(z-z_{in})}{U^{CFD}_{in}}
    	\end{equation}
    	
 The effectiveness of the grid enhanced cross flow model was determined by comparing exit bulk temperature profiles across a variety of assembly designs against experimental and CFD results.  The results indicated a marked improvement in the rod-assembly outlet temperature distribution at little additional computational cost as compared to CTF without CFD informed grid enhanced cross flow corrections.  
 
 The next bodies of work are closer in alignment with traditional downscaling techniques.  These class of hi2lo procedures are not statistical in nature, but rather seek to correct spatial biases in the field predictions made by a low fidelity subchannel code.

    
S. Yao et al. developed an empirical model of the heat transfer coefficient downstream of spacer grids \cite{yao82}.
    An empirical relationship between the Nusselt number ratio and the vane angle, $\phi$, blockage ratio $\epsilon$, dimensionless distance from the grid, $x/D$, and fraction of flow area impeded by the vanes, $A$, was produced.  This relationship is provided in equation \ref{eq:yao_htc}.
    
\begin{equation}
\frac{Nu}{Nu_0}  = \left[ 1 + 5.55 \epsilon^2 e^{-0.13(x/D)}\right] + \left[ 1 + A^2\mathrm{tan}^2\phi e^{-0.034(x/D)} \right]
\label{eq:yao_htc}
\end{equation}
Where the first term is accounts for the effect of grid flow restriction and the second term represents the contribution of vane induced swirl on the heat transfer.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{../proposal/images/grid_nu_eff}
    \caption{S. Yao empirical Nusselt number ratio vs. distance from upstream spacer grid.}
    \label{fig:gridnueff}
\end{figure}

    Similar to Yao's approach for capturing rod-enhanced heat transfer,  B. Salko et al. developed a CFD-Informed hi2lo spatial remapping procedure for CILC/CIPS screening \cite{salko17}.  Rather than establishing a general empirical relationship between grid geometric features and the flow field, Salko developed grid-specific maps.  The developed multiplier maps are applicable only to the grid designed on which they are based.  In contrast to Yao's approach, this enables a much higher resolution flow field effects on the surface temperature distribution to be retained in the multiplier maps.  In addition to generating heat transfer multiplier maps, this method developed a TKE mapping procedure since both fields are required for accurate crud predictions.  Both maps are applied in conjunction to a baseline CTF result to produce grid enhanced surface temperature and TKE distributions at runtime of the CTF model.
    
    First, an intermediate coupling mesh is constructed on the surface rods with a resolution between the CFD mesh and the CTF grid is defined.  Next, the raw CFD surface fields are then mapped to the coupling mesh.  In this approach crud is to be grown on the intermediate coupling grid.  In theory, this grid can be refined to be equivalent to the CFD mesh size and indeed this would reduce interpolation error in the hi2lo procedure \cite{salko17}.
       
    The multiplier maps capture the ratio of the CFD predicted HTC and TKE surface distributions to the same surface distributions on a bare rod with no spacer grids present.
    Convective HTC remap is described by equations \label{eq:htc_remap_ctf_1} and \label{eq:htc_remap_ctf_2}.
    
    \begin{equation}
        \mathbf m_h = \frac{(Nu)_{cfd}}{(Nu)_{0}} = \frac{h_{cfd} L_{cfd} k_{0} }{h_{0}k_{cfd} L_{0}}
         \label{eq:htc_remap_ctf_1}
    \end{equation}
    Where $Nu$ is the Nusselt number.  Assuming equal length scales and thermal conductivities:
    \begin{equation}
        \mathbf m_h = \frac{h_{cfd}}{h_{0}} = \frac{q_{cfd}(T-T_\infty)_{0}}{q_{0}(T-T_\infty)_{cfd}}
        \label{eq:htc_remap_ctf_2}
    \end{equation}
    It is important to note that a uniform heat flux is used in both the bare and full rod case so that $q_{cfd}/q_0 =1 $.
    Apply HTC remap to the original CTF HTC by equation \ref{eq:htc_remap_ctf_3}.
    \begin{equation}
        \hat h_{l} = \mathbf m_h h_{ctf}
        \label{eq:htc_remap_ctf_3}
    \end{equation}
    $\hat h_l$ is the hi2lo remapped convective heat transfer coefficient.  In CTF the wall heat transfer is split between phases:
    \begin{equation}
        q'' = q''_{conv} + q''_{boil} = (\hat h_l)(T-T_{\infty}) + q''_{boil}(T)
    \end{equation}
    In order to compute augmented hi2lo surface temperatures
    several iterations are required to converge upon the correct surface temperature, $\hat T_s$ due to the surface boiling term.

    \begin{algorithm}[H]
        \captionsetup{labelfont={sc,bf}, labelsep=newline}
        \caption{Heat transfer coefficient map based hi2lo method for crud prediction (Salko. et. al.).}
    \setstretch{0.8}  % reduce spacing in algo sec
    \begin{algorithmic}[1]
    \STATE \textbf{Initialization} 
    \STATE Guess $T^{i=0}_s=T_0$.  Maximum number, $N$ iterations.

        \FOR {i in range($N$):}
           \STATE Evaluate effective multiphase CTF HTC: $h_{eff} = h_{{ctf}}(T^i_{s}, \hat h_l, q'')$ \;
           \STATE Compute new hi2lo surface temperatures: $T_{s} = \frac{q''}{h_{eff}} + T_\infty$ \;
           \STATE  Under relax  $T^{i+1}_{s} = \omega T_{s} + (1 - \omega) T^{i}_{s} ;\ \omega < 1.$ \;
           \STATE  \textbf{break if}:  $|T^{i+1}_s - T^i_s| < tol$ \;
        \ENDFOR 
    \STATE \textbf{return}: $\hat T_s = T^{i+1}_s$
    \end{algorithmic}
    \end{algorithm}
    Where $h_{ctf}(\cdot)$ is a callable CTF function that returns and effective multiphase HTC, $h_{eff}$.

    The TKE remap is constructed by evaluation the ratio given in equation \ref{eq:tke_map} on all CTF faces.
    \begin{equation}
       \mathbf m_{k} = \frac{k_{cfd}}{k_{0}}
       \label{eq:tke_map}
    \end{equation}
    Where $k_0$ is the TKE distribution for a bare rod without spacer grids.
    The TKE multiplier map is applied in the same manner as the HTC map.
       \begin{equation}
       \hat k = \mathbf m_k k_{ctf}
       \end{equation}
    Crud is grown on the coupling mesh using augmented temperature and TKE surface fields. By this method the integrated crud mass over a CTF face is given by equation \ref{eq:ctf_hi2lo_crud_est}.
     \begin{equation}
     C_m = \frac{1}{A} \sum_i^N \mathcal G(\hat T_{s_i}, \hat k_i, q''_i) a_i
     \label{eq:ctf_hi2lo_crud_est}
     \end{equation}
    Where $A$ is the area of the CTF face and $a_i$ is the area of each cell face on the crud coupling mesh.

    
    A key assumption that the multiplier maps are insensitive flow rate was made in the first implementation of this downscaling technique.  However this assumption is not strictly true: The multiplier maps carry some dependence on the inlet flow conditions.  An increase in flow rate changes the shape and extent of the wake region downstream of spacer grids which impacts the rod surface temperature and TKE fields.

    An extension of the multiplier map hi2lo procedure could linearly interpolate between multiplier maps developed at high and low inlet flow rate conditions.
    \begin{align*}
        \mathbf m_k &= \alpha \mathbf m_k^h + (1 - \alpha) \mathbf m_k^l \\
                    &= \alpha \frac{k^h_{cfd}}{k^h_0} + (1 - \alpha) \frac{k^l_{cfd}}{k^l_0} \\
        \alpha & = \frac{\dot m_i - \dot m_i^l }{\dot m_i^h - \dot m_i^l}
    \end{align*}
    Where $\dot m_i$ is the inlet mass flow rate.  The superscript, $(\cdot)^l$, represents low flow conditions and $(\cdot)^h$ represent high flow conditions.


\begin{figure}[H]%
    \centering
    \subfloat[CTF/MAMBA crud predictions without hi2lo remapping on a quarter symmetric pin.]{{\includegraphics[width=0.45\linewidth]{../proposal/images/ctf_crud_orig} }}%
    \qquad
    \subfloat[CTF/MAMBA crud predictions using hi2lo remapping on a quarter symmetric pin.]{{\includegraphics[width=0.45\linewidth]{../proposal/images/ctf_crud_reconstructed} }}% 
    \caption[The impact of spatial HTC hi2lo remapping on CTF/MAMBA crud predictions.]{The impact of spatial HTC hi2lo remapping on CTF/MAMBA crud predictions.}%
    \label{fig:htc_remap_crud}%
\end{figure}


    Some simplifications are made in this mapping.  For a given assembly, the multiplier maps have been shown to have a high span to span repeatability.  Therefore, a representative map is derived from a single span in a fully developed flow field.  This representative map is then applied to all other spans in the model.

    The multiplier map may not be transferable to other assemblies in the core due to geometric effects including the orientation of neighboring assemblies and TH/neutronics feedbacks.  This represents a limitation to the spatial mapping procedure as unique maps must be generated for different assemblies in the core.
     
    Blyth produced CFD informed grid enhanced heat transfer models for the advanced subchannel code, CTF.  This work presented strategies for processing CFD data for use in generating enhanced heat transfer maps and for computing the form loss coefficient across spacer grids.  Blyth's work served as a precursor to Salko's CFD informed method for developing HTC and TKE maps.

    T. Hengal. Regression Kriging application to soil composition prediction as function of elevation, distance to river, ect. \cite{Hengl07}
    
    Boosted regression and classification applications. \cite{moisen2006}, \cite{friedman2002}



